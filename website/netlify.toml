[build]
command = "react-router build"
publish = "build/client"

[functions]
directory = "netlify/functions"

[build.processing.html]
pretty_urls = false

[dev]
command = "react-router dev"

# MCP Game proxy
[[redirects]]
  from = "/happyholidays/mcp"
  to = "https://mcpgame.netlify.app/mcp"
  status = 200
  force = true

# MCP OAuth discovery (for Claude.ai connector)
[[redirects]]
  from = "/.well-known/oauth-protected-resource"
  to = "https://mcpgame.netlify.app/.well-known/oauth-protected-resource"
  status = 200
  force = true

[[redirects]]
  from = "/.well-known/oauth-protected-resource/*"
  to = "https://mcpgame.netlify.app/.well-known/oauth-protected-resource"
  status = 200
  force = true

[[redirects]]
  from = "/.well-known/oauth-authorization-server"
  to = "https://mcpgame.netlify.app/.well-known/oauth-authorization-server"
  status = 200
  force = true

[[redirects]]
  from = "/.well-known/oauth-authorization-server/*"
  to = "https://mcpgame.netlify.app/.well-known/oauth-authorization-server"
  status = 200
  force = true

# Legacy posts: serve both URLs (don't break cached 301s)
[[redirects]]
  from = "/blog/cubicles-for-agents"
  to = "/blog/cubicles-for-agents/index.html"
  status = 200

[[redirects]]
  from = "/blog/cubicles-for-agents/"
  to = "/blog/cubicles-for-agents/index.html"
  status = 200

[[redirects]]
  from = "/blog/the-highest-quality-codebase"
  to = "/blog/the-highest-quality-codebase/index.html"
  status = 200

[[redirects]]
  from = "/blog/the-highest-quality-codebase/"
  to = "/blog/the-highest-quality-codebase/index.html"
  status = 200

# New posts: redirect trailing slash to no trailing slash
[[redirects]]
  from = "/blog/*/"
  to = "/blog/:splat"
  status = 301

# Serve new posts without redirect
[[redirects]]
  from = "/blog/*"
  to = "/blog/:splat/index.html"
  status = 200

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
